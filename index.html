<!DOCTYPE html>
<html lang="it">
<head>
    <!-- Metadati Base -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Ottimizzazione SEO -->
    <title>Cyber Threat Intelligence Hub | Notizie Sicurezza Informatica Tradotte</title>
    <meta name="description" content="Aggregatore di notizie cybersecurity con fonti selezionate: SecurityInfo, KrebsOnSecurity, The Hacker News. Traduzione automatica integrata per hacker etici">
    <meta name="keywords" content="sicurezza informatica, hacker news, malware, vulnerabilit√†, hacking etico, traduzione automatica">
    <meta name="author" content="Il Tuo Nome">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://cyber-news-aggregator.netlify.app/" />

    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="Cyber Threat Intelligence Hub">
    <meta property="og:description" content="Le ultime notizie sulla sicurezza informatica tradotte in italiano">
    <meta property="og:url" content="https://cyber-news-aggregator.netlify.app/">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://cyber-news-aggregator.netlify.app/preview.png">
    <meta property="og:locale" content="it_IT">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EZDWXBLCFG"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-EZDWXBLCFG', {
        page_title: document.title,
        page_path: window.location.pathname
      });
    </script>

    <!-- Stili CSS -->
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 40px;
            font-style: italic;
        }
        .controls {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
        }
        .feed-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }
        .feed-column {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            padding: 20px;
            transition: transform 0.3s ease;
        }
        .feed-column:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .feed-title {
            font-size: 1.4em;
            color: #3498db;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .feed-title img {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }
        .feed-item {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #eee;
        }
        .item-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        .item-title a {
            color: inherit;
            text-decoration: none;
            transition: color 0.2s;
        }
        .item-title a:hover {
            color: #3498db;
            text-decoration: underline;
        }
        .item-date {
            font-size: 0.85em;
            color: #7f8c8d;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .item-date::before {
            content: "üìÖ";
            font-size: 0.9em;
        }
        .item-description {
            font-size: 0.95em;
            color: #555;
            line-height: 1.5;
        }
        .item-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        .tag {
            background-color: #e1f5fe;
            color: #0288d1;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 500;
        }
        .tag.lang {
            background-color: #e8f5e9;
            color: #388e3c;
        }
        .loading {
            text-align: center;
            padding: 30px;
            font-style: italic;
            color: #7f8c8d;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error {
            color: #e74c3c;
            font-style: italic;
            padding: 15px;
            background-color: #fdecea;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .fallback-link {
            margin-top: 10px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #2980b9;
        }
        button.secondary {
            background-color: #ecf0f1;
            color: #333;
        }
        button.secondary:hover {
            background-color: #d5dbdb;
        }
        button.active {
            background-color: #2c3e50;
            color: white;
        }
        .translate-info {
            font-size: 0.8em;
            color: #7f8c8d;
            margin-top: 5px;
            font-style: italic;
        }
        @media (max-width: 768px) {
            .feed-container {
                grid-template-columns: 1fr;
            }
            .controls {
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <h1>Cyber Threat Intelligence Hub</h1>
    <div class="subtitle">Notizie tradotte su malware, vulnerabilit√† e sicurezza informatica</div>
    
    <div class="controls">
        <div class="category-filter" id="categoryFilter">
            <button class="active" data-category="all">Tutte</button>
            <button data-category="italia">Italia</button>
            <button data-category="global">Global</button>
            <button data-category="malware">Malware</button>
            <button data-category="vulnerabilita">Vulnerabilit√†</button>
            <button data-category="hacking">Hacking</button>
        </div>
        <button id="translateToggle" class="secondary">Attiva traduzione automatica</button>
    </div>
    
    <div class="feed-container" id="feedContainer">
        <!-- Le colonne dei feed verranno aggiunte dinamicamente via JavaScript -->
    </div>

    <!-- Schema.org JSON-LD per SEO avanzato -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Cyber Threat Intelligence Hub",
      "url": "https://cyber-news-aggregator.netlify.app/",
      "description": "Aggregatore di notizie sulla sicurezza informatica con traduzione automatica",
      "publisher": {
        "@type": "Organization",
        "name": "Cyber News Aggregator",
        "logo": {
          "@type": "ImageObject",
          "url": "https://cyber-news-aggregator.netlify.app/logo.png"
        }
      }
    }
    </script>

    <!-- Script principale -->
    <script>
        // Configurazione
        const TRANSLATE_ENABLED = false;
        const DEEPL_API_KEY = '';
        const TRANSLATION_CACHE = new Map();
        
        // Fonti di notizie VERIFICATE
        const CYBER_NEWS_SOURCES = [
            // Fonti italiane
            {
                id: "securityinfo",
                name: "SecurityInfo",
                rss: "https://www.securityinfo.it/feed/",
                fallback: "https://www.securityinfo.it",
                icon: "https://www.securityinfo.it/wp-content/themes/securityinfo/img/favicon.ico",
                category: "italia",
                tags: ["sicurezza", "hacking", "vulnerabilit√†"],
                lang: "it"
            },
            {
                id: "redhotcyber",
                name: "Red Hot Cyber",
                rss: "https://www.redhotcyber.com/feed/",
                fallback: "https://www.redhotcyber.com",
                icon: "https://www.redhotcyber.com/wp-content/uploads/2021/09/cropped-RHC-32x32.png",
                category: "italia",
                tags: ["threat intelligence", "malware", "cybercrime"],
                lang: "it"
            },
            {
                id: "certagid",
                name: "CERT-AGID",
                rss: "https://cert-agid.gov.it/feed/",
                fallback: "https://cert-agid.gov.it",
                icon: "https://cert-agid.gov.it/wp-content/uploads/2021/12/cropped-favicon-32x32.png",
                category: "italia",
                tags: ["vulnerabilit√†", "patch", "sicurezza nazionale"],
                lang: "it"
            },
            
            // Fonti internazionali
            {
                id: "krebs",
                name: "KrebsOnSecurity",
                rss: "https://krebsonsecurity.com/feed/",
                fallback: "https://krebsonsecurity.com",
                icon: "https://krebsonsecurity.com/favicon.ico",
                category: "global",
                tags: ["cybercrime", "investigazioni", "data breaches"],
                lang: "en"
            },
            {
                id: "thn",
                name: "The Hacker News",
                rss: "https://feeds.feedburner.com/TheHackersNews",
                fallback: "https://thehackernews.com",
                icon: "https://thehackernews.com/favicon.ico",
                category: "global",
                tags: ["hacking", "malware", "vulnerabilit√†"],
                lang: "en"
            },
            {
                id: "bleeping",
                name: "BleepingComputer",
                rss: "https://www.bleepingcomputer.com/feed/",
                fallback: "https://www.bleepingcomputer.com",
                icon: "https://www.bleepingcomputer.com/favicon.ico",
                category: "global",
                tags: ["malware", "ransomware", "zero-day"],
                lang: "en"
            },
            {
                id: "darkreading",
                name: "Dark Reading",
                rss: "https://www.darkreading.com/rss.xml",
                fallback: "https://www.darkreading.com",
                icon: "https://www.darkreading.com/favicon.ico",
                category: "global",
                tags: ["enterprise security", "threat intelligence", "vulnerabilities"],
                lang: "en"
            },
            {
                id: "infosecurity",
                name: "Infosecurity Magazine",
                rss: "https://www.infosecurity-magazine.com/rss/news/",
                fallback: "https://www.infosecurity-magazine.com",
                icon: "https://www.infosecurity-magazine.com/favicon.ico",
                category: "global",
                tags: ["enterprise security", "risk management", "compliance"],
                lang: "en"
            },
            {
                id: "securityweek",
                name: "SecurityWeek",
                rss: "https://feeds.feedburner.com/securityweek",
                fallback: "https://www.securityweek.com",
                icon: "https://www.securityweek.com/favicon.ico",
                category: "global",
                tags: ["cyber threats", "vulnerabilities", "security research"],
                lang: "en"
            },
            {
                id: "welivesecurity",
                name: "WeLiveSecurity",
                rss: "https://www.welivesecurity.com/feed/",
                fallback: "https://www.welivesecurity.com",
                icon: "https://www.welivesecurity.com/wp-content/themes/welivesecurity/assets/favicon.ico",
                category: "global",
                tags: ["privacy", "malware", "security news"],
                lang: "en"
            }
        ];

        // Caricamento feed con sistema di fallback
        async function loadFeed(source) {
            const container = document.getElementById(source.id);
            const timeout = 10000;
            
            try {
                // Tentativo 1: Proxy primario
                let response = await fetchWithTimeout(
                    `https://api.allorigins.win/raw?url=${encodeURIComponent(source.rss)}`, 
                    {}, 
                    timeout
                );
                
                // Tentativo 2: Proxy secondario
                if (!response.ok) {
                    response = await fetchWithTimeout(
                        `https://cors-anywhere.herokuapp.com/${source.rss}`, 
                        {}, 
                        timeout
                    );
                }
                
                if (!response || !response.ok) {
                    throw new Error(`HTTP ${response?.status || 'no-response'}`);
                }
                
                const text = await response.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(text, "text/xml");
                
                if (xmlDoc.querySelector("parsererror")) {
                    throw new Error("Errore nel parsing del feed XML");
                }
                
                let items = xmlDoc.querySelectorAll("item, entry");
                if (items.length === 0) {
                    throw new Error("Nessun articolo trovato nel feed");
                }
                
                displayItems(items, source);
                
                // Traccia evento GA4 per feed caricato
                if (typeof gtag === 'function') {
                    gtag('event', 'feed_loaded', {
                        feed_name: source.name,
                        item_count: items.length
                    });
                }
                
            } catch (error) {
                console.error(`Errore per ${source.name}:`, error);
                showFallback(source, error.message);
                
                // Traccia errore su GA4
                if (typeof gtag === 'function') {
                    gtag('event', 'feed_error', {
                        feed_name: source.name,
                        error: error.message
                    });
                }
            }
        }

        // Visualizzazione articoli
        async function displayItems(items, source) {
            const container = document.getElementById(source.id);
            container.querySelector('.loading')?.remove();
            
            const itemsToDisplay = Array.from(items).slice(0, 8);
            
            for (const item of itemsToDisplay) {
                const title = item.querySelector("title")?.textContent || "Notizia senza titolo";
                let link = item.querySelector("link")?.textContent || source.fallback;
                
                if (!link.startsWith("http") && item.querySelector("link[href]")) {
                    link = item.querySelector("link[href]").getAttribute("href");
                }
                
                const pubDate = item.querySelector("pubDate, published, date")?.textContent || "";
                let description = item.querySelector("description, content, summary")?.textContent || "";
                description = cleanDescription(description);
                
                const itemEl = document.createElement('div');
                itemEl.className = 'feed-item';
                itemEl.setAttribute('data-category', source.category);
                itemEl.setAttribute('data-tags', source.tags.join(','));
                itemEl.setAttribute('data-lang', source.lang);
                
                const langTag = `<span class="tag lang">${source.lang.toUpperCase()}</span>`;
                
                itemEl.innerHTML = `
                    <div class="item-title"><a href="${link}" target="_blank" rel="noopener noreferrer" onclick="trackLinkClick('${source.name}', '${title}')">${title}</a></div>
                    <div class="item-date">${formatDate(pubDate)} ${langTag}</div>
                    <div class="item-description" data-original="${escapeHtml(description)}">${description}</div>
                    <div class="item-tags">
                        ${source.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                `;
                
                container.appendChild(itemEl);
                
                if (document.getElementById('translateToggle').classList.contains('active') && source.lang !== 'it') {
                    await translateItem(itemEl, source.lang);
                }
            }
        }

        // Traccia click su articoli in GA4
        window.trackLinkClick = function(sourceName, title) {
            if (typeof gtag === 'function') {
                gtag('event', 'article_click', {
                    source: sourceName,
                    article_title: title,
                    event_callback: function() {
                        window.open(this.href, '_blank');
                    }
                });
            }
        };

        // Helper functions (fetchWithTimeout, translateItem, cleanDescription, etc.)
        // ... (mantieni tutte le funzioni helper esistenti) ...

        // Inizializzazione
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('feedContainer');
            
            CYBER_NEWS_SOURCES.forEach(source => {
                const column = document.createElement('div');
                column.className = 'feed-column';
                column.id = source.id;
                column.setAttribute('data-category', source.category);
                
                column.innerHTML = `
                    <div class="feed-title">
                        <img src="${source.icon}" alt="${source.name} icon" 
                             onerror="this.src='https://via.placeholder.com/24/3498db/ffffff?text=${source.name[0]}'">
                        ${source.name}
                    </div>
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        Caricamento in corso...
                    </div>
                `;
                
                container.appendChild(column);
                setTimeout(() => loadFeed(source), Math.random() * 3000);
            });
            
            setupCategoryFilter();
            setupTranslateToggle();
        });

        // Traccia la visita iniziale
        if (typeof gtag === 'function') {
            gtag('event', 'page_view', {
                page_title: document.title,
                page_location: window.location.href,
                page_path: window.location.pathname
            });
        }
    </script>
</body>
</html>
